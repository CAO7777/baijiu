<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>匠心酿造 · 数字人画像与白酒产品模拟分析</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Serif+SC:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>
  <svg aria-hidden="true" width="0" height="0" class="hidden">
    <symbol id="i-edit" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></symbol>
    <defs>
      <linearGradient id="g-gold" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#F4E6C4"/><stop offset="50%" stop-color="#E3C37B"/><stop offset="100%" stop-color="#C9A24E"/></linearGradient>
      <symbol id="i-bottle" viewBox="0 0 24 24"><path d="M10 2h4v3l1 2v4h-6V7l1-2V2zM8 11h8l2 4v6a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1v-6l2-4zM9 15l-1.2 3h8.4L15 15H9z" fill="currentColor"/></symbol>
      <symbol id="i-cup" viewBox="0 0 24 24"><path d="M4 4h16v3a5 5 0 0 1-5 5H9A5 5 0 0 1 4 7V4zm4 10h8l-1 5H9l-1-5z" fill="currentColor"/></symbol>
      <symbol id="i-wheat" viewBox="0 0 24 24"><path d="M12 2l2 2-2 2-2-2 2-2zm-2 6l2 2-2 2-2-2 2-2zm6 0l2 2-2 2-2-2 2-2zM8 14l2 2-2 2-2-2 2-2zm8 0l2 2-2 2-2-2 2-2zM11 12h2v10h-2z" fill="currentColor"/></symbol>
      <symbol id="i-price" viewBox="0 0 24 24"><path d="M12 2l8 8-8 12L4 10l8-8zm1 5h-2v2H9v2h2v2h2v-2h2V9h-2V7z" fill="currentColor"/></symbol>
      <symbol id="i-location" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 5 7 13 7 13s7-8 7-13a7 7 0 0 0-7-7zm0 9a2 2 0 1 1 0-4 2 2 0 0 1 0 4z" fill="currentColor"/></symbol>
      <symbol id="i-quill" viewBox="0 0 24 24"><path d="M20 2L8 14l-2 6 6-2L22 4l-2-2zM4 20h6v2H4z" fill="currentColor"/></symbol>
      <symbol id="i-download" viewBox="0 0 24 24"><path d="M12 3v10l4-4 1 1-6 6-6-6 1-1 4 4V3h2zm-9 15h18v2H3z" fill="currentColor"/></symbol>
      
      <symbol id="i-users" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
        <circle cx="9" cy="7" r="4"></circle>
        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
      </symbol>

      <symbol id="i-upload" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></symbol>
    </defs>
  </svg>

  <div class="texture"></div>

  <div class="app-shell">
    <header class="topbar">
      <div class="brand">
        <div id="brand-polyu" class="brand-profile">
            <img src="{{ url_for('static', filename='image.png') }}" alt="PolyU Logo" class="monogram-logo">
            <div class="brand-text">
              <span>港理工数字人建模智能营销网站</span>
              <em>PolyU Digital Persona & Marketing A.I.</em>
            </div>
        </div>
        
        <div id="brand-mingyin" class="brand-profile hidden">
            <div class="monogram">酿</div>
            <div class="brand-text"><span>匠心酿造</span><em>Persona & Product Insight</em></div>
        </div>
    </div>

    <div class="topbar-controls">
        <nav class="steps" aria-label="步骤导航">
            <button class="step-pill active" data-step="1"><svg class="icon"><use href="#i-quill"/></svg>创建画像</button>
            <button class="step-pill" data-step="2"><svg class="icon"><use href="#i-bottle"/></svg>产品信息</button>
            <button class="step-pill" data-step="3"><svg class="icon"><use href="#i-users"/></svg>独立报告</button>
            <button class="step-pill" data-step="4"><svg class="icon"><use href="#i-cup"/></svg>整体分析</button>
        </nav>
        
        <div class="brand-switcher">
            <select id="brandSelect">
                <option value="polyu" selected>PolyU</option>
                <option value="mingyin">匠心酿造</option>
            </select>
        </div>
    </div>
    </header>

    <main class="container">
      <section class="panel step" id="step-1" aria-labelledby="title-step1">
        <header class="panel-head">
          <h1 id="title-step1" class="display with-icon"><svg class="icon xl"><use href="#i-quill"/></svg>创建数字人画像</h1>
          <p class="lead">设置画像数量与关键属性比例，系统将自动合成符合要求的数字人。</p>
        </header>
        <form id="persona-form" class="persona-config" onsubmit="return false;">
          <div class="group">
            <h2 class="h2 with-icon"><svg class="icon"><use href="#i-users"/></svg>画像总体设置</h2>
            <div class="form-grid two-col">
              <label class="field">
                <span>画像数量</span>
                <input id="personaCount" type="number" min="1" max="50" value="6" />
              </label>
              <div class="field">
                <span>年龄区间</span>
                <div class="range-inputs">
                  <input id="ageMin" type="number" min="18" max="80" value="25" />
                  <span class="range-sep">—</span>
                  <input id="ageMax" type="number" min="18" max="80" value="45" />
                </div>
              </div>
            </div>
          </div>

          <div class="group">
            <div class="group-head">
              <h2 class="h2 with-icon"><svg class="icon"><use href="#i-location"/></svg>城市分布</h2>
              <p class="hint">选择超一线及核心城市，并为每座城市指定比例（总和 100）。</p>
            </div>
            <div id="cityRatioList" class="city-ratio-list"></div>
            <button type="button" class="btn ghost small" id="addCityRatio">添加城市比重</button>
          </div>

          <div class="group">
            <h2 class="h2 with-icon"><svg class="icon"><use href="#i-wheat"/></svg>属性比例设定</h2>
            <div class="ratio-section">
              <div class="ratio-group" data-group="gender">
                <div class="ratio-head">
                  <h3>性别</h3>
                  <span class="hint">总和需为 100</span>
                </div>
                <div class="ratio-grid ratio-with-slider">
                  <div class="field-slider-group">
                      <label class="field">
                          <span>男性</span>
                          <input type="number" min="0" max="100" value="50" class="ratio-input" data-group="gender" data-option="男" />
                      </label>
                      <input type="range" min="0" max="100" value="50" class="ratio-slider" aria-label="男性比例滑块">
                  </div>
                  <div class="field-slider-group">
                      <label class="field">
                          <span>女性</span>
                          <input type="number" min="0" max="100" value="50" class="ratio-input" data-group="gender" data-option="女" />
                      </label>
                      <input type="range" min="0" max="100" value="50" class="ratio-slider" aria-label="女性比例滑块">
                  </div>
                </div>
              </div>

              <div class="ratio-group">
                <div class="ratio-head">
                  <h3>MBTI 倾向</h3>
                  <span class="hint">每组内总和需为 100</span>
                </div>
                <div class="ratio-pairs">
                  <div class="ratio-pair" data-group="mbti_energy">
                    <span class="ratio-label">能量获取</span>
                    <div class="ratio-grid ratio-with-slider">
                      <div class="field-slider-group">
                          <label class="field">
                              <span>外向 E</span>
                              <input type="number" min="0" max="100" value="50" class="ratio-input" data-group="mbti_energy" data-option="E" />
                          </label>
                          <input type="range" min="0" max="100" value="50" class="ratio-slider" aria-label="外向 E 比例滑块">
                      </div>
                      <div class="field-slider-group">
                          <label class="field">
                              <span>内向 I</span>
                              <input type="number" min="0" max="100" value="50" class="ratio-input" data-group="mbti_energy" data-option="I" />
                          </label>
                          <input type="range" min="0" max="100" value="50" class="ratio-slider" aria-label="内向 I 比例滑块">
                      </div>
                    </div>
                  </div>
                  <div class="ratio-pair" data-group="mbti_info">
                    <span class="ratio-label">信息接收</span>
                    <div class="ratio-grid ratio-with-slider">
                      <div class="field-slider-group">
                          <label class="field">
                              <span>实感 S</span>
                              <input type="number" min="0" max="100" value="50" class="ratio-input" data-group="mbti_info" data-option="S" />
                          </label>
                          <input type="range" min="0" max="100" value="50" class="ratio-slider" aria-label="实感 S 比例滑块">
                      </div>
                      <div class="field-slider-group">
                          <label class="field">
                              <span>直觉 N</span>
                              <input type="number" min="0" max="100" value="50" class="ratio-input" data-group="mbti_info" data-option="N" />
                          </label>
                          <input type="range" min="0" max="100" value="50" class="ratio-slider" aria-label="直觉 N 比例滑块">
                      </div>
                    </div>
                  </div>
                  <div class="ratio-pair" data-group="mbti_decision">
                    <span class="ratio-label">决策方式</span>
                    <div class="ratio-grid ratio-with-slider">
                      <div class="field-slider-group">
                          <label class="field">
                              <span>思考 T</span>
                              <input type="number" min="0" max="100" value="50" class="ratio-input" data-group="mbti_decision" data-option="T" />
                          </label>
                          <input type="range" min="0" max="100" value="50" class="ratio-slider" aria-label="思考 T 比例滑块">
                      </div>
                      <div class="field-slider-group">
                          <label class="field">
                              <span>情感 F</span>
                              <input type="number" min="0" max="100" value="50" class="ratio-input" data-group="mbti_decision" data-option="F" />
                          </label>
                          <input type="range" min="0" max="100" value="50" class="ratio-slider" aria-label="情感 F 比例滑块">
                      </div>
                    </div>
                  </div>
                  <div class="ratio-pair" data-group="mbti_life">
                    <span class="ratio-label">生活态度</span>
                    <div class="ratio-grid ratio-with-slider">
                      <div class="field-slider-group">
                          <label class="field">
                              <span>判断 J</span>
                              <input type="number" min="0" max="100" value="50" class="ratio-input" data-group="mbti_life" data-option="J" />
                          </label>
                          <input type="range" min="0" max="100" value="50" class="ratio-slider" aria-label="判断 J 比例滑块">
                      </div>
                      <div class="field-slider-group">
                          <label class="field">
                              <span>感知 P</span>
                              <input type="number" min="0" max="100" value="50" class="ratio-input" data-group="mbti_life" data-option="P" />
                          </label>
                          <input type="range" min="0" max="100" value="50" class="ratio-slider" aria-label="感知 P 比例滑块">
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="ratio-group" data-group="drink_frequency">
                <div class="ratio-head">
                  <h3>饮酒频率</h3>
                  <span class="hint">总和需为 100</span>
                </div>
                <div class="ratio-grid four ratio-with-slider">
                  <div class="field-slider-group">
                      <label class="field">
                          <span>从不</span>
                          <input type="number" min="0" max="100" value="10" class="ratio-input" data-group="drink_frequency" data-option="从不" />
                      </label>
                      <input type="range" min="0" max="100" value="10" class="ratio-slider" aria-label="从不比例滑块">
                  </div>
                  <div class="field-slider-group">
                      <label class="field">
                          <span>每月 1-2 次</span>
                          <input type="number" min="0" max="100" value="35" class="ratio-input" data-group="drink_frequency" data-option="每月1-2次" />
                      </label>
                      <input type="range" min="0" max="100" value="35" class="ratio-slider" aria-label="每月1-2次比例滑块">
                  </div>
                  <div class="field-slider-group">
                      <label class="field">
                          <span>每周</span>
                          <input type="number" min="0" max="100" value="35" class="ratio-input" data-group="drink_frequency" data-option="每周" />
                      </label>
                      <input type="range" min="0" max="100" value="35" class="ratio-slider" aria-label="每周比例滑块">
                  </div>
                  <div class="field-slider-group">
                      <label class="field">
                          <span>几乎每天</span>
                          <input type="number" min="0" max="100" value="20" class="ratio-input" data-group="drink_frequency" data-option="几乎每天" />
                      </label>
                      <input type="range" min="0" max="100" value="20" class="ratio-slider" aria-label="几乎每天比例滑块">
                  </div>
                </div>
              </div>

              <div class="ratio-group" data-group="flavor">
                <div class="ratio-head">
                  <h3>偏好香型</h3>
                  <span class="hint">总和需为 100</span>
                </div>
                <div class="ratio-grid four ratio-with-slider">
                  <div class="field-slider-group">
                      <label class="field">
                          <span>酱香型</span>
                          <input type="number" min="0" max="100" value="35" class="ratio-input" data-group="flavor" data-option="酱香型" />
                      </label>
                      <input type="range" min="0" max="100" value="35" class="ratio-slider" aria-label="酱香型比例滑块">
                  </div>
                  <div class="field-slider-group">
                      <label class="field">
                          <span>浓香型</span>
                          <input type="number" min="0" max="100" value="35" class="ratio-input" data-group="flavor" data-option="浓香型" />
                      </label>
                      <input type="range" min="0" max="100" value="35" class="ratio-slider" aria-label="浓香型比例滑块">
                  </div>
                  <div class="field-slider-group">
                      <label class="field">
                          <span>清香型</span>
                          <input type="number" min="0" max="100" value="15" class="ratio-input" data-group="flavor" data-option="清香型" />
                      </label>
                      <input type="range" min="0" max="100" value="15" class="ratio-slider" aria-label="清香型比例滑块">
                  </div>
                  <div class="field-slider-group">
                      <label class="field">
                          <span>其他</span>
                          <input type="number" min="0" max="100" value="15" class="ratio-input" data-group="flavor" data-option="其他" />
                      </label>
                      <input type="range" min="0" max="100" value="15" class="ratio-slider" aria-label="其他比例滑块">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
        <div class="actions split">
          <div class="left">
              <button id="generatePersonas" class="btn primary"><svg class="icon"><use href="#i-users"/></svg>生成用户画像</button>
  
              <label for="uploadPersonaFile" class="btn">
                  <svg class="icon"><use href="#i-upload"/></svg>
                  上传画像
              </label>
              <input type="file" id="uploadPersonaFile" class="file-input" accept=".json">
  
              <button type="button" class="btn" id="downloadPersonaFile">
                  <svg class="icon"><use href="#i-download"/></svg>
                  下载画像
              </button>

              <button class="btn outline next" data-next="2"><svg class="icon"><use href="#i-bottle"/></svg>下一步：填写产品信息</button>
          </div>
          <div class="right">
              <p class="hint">提示：生成或上传画像后，可点击卡片右上角编辑。</p>
          </div>
        </div>
        <div id="personaSummary" class="persona-summary empty">
          <div class="placeholder-content">
            <div class="spinner"></div>
            <p>尚未生成画像，请先设置参数并点击“生成用户画像”。</p>
          </div>
        </div>
      </section>

      <section class="panel step hidden" id="step-2" aria-labelledby="title-step2">
        <header class="panel-head">
          <h1 id="title-step2" class="display with-icon"><svg class="icon xl"><use href="#i-bottle"/></svg>添加产品信息</h1>
          <p class="lead">上传产品描述与图片，生成专属洞察。</p>
        </header>
        <div class="grid-aside">
          <div>
            <label class="field block">
              <span>产品描述</span>
              <textarea id="productDesc" rows="8" placeholder="例如：这是一款来自贵州茅台镇的53度酱香型白酒，采用传统坤沙工艺酿造，口感醇厚，回味悠长。"></textarea>
            </label>
          </div>
          <div>
            <label class="field block">
              <span>产品图片</span>
              <input id="productImg" type="file" accept="image/*" class="file-input" />
              <label for="productImg" class="btn outline">选择文件</label>
              <div id="productPreview" class="preview tip">建议上传横向高清图，展示瓶身与包装细节。</div>
            </label>
          </div>
        </div>
        <div class="actions">
          <button class="btn outline prev" data-prev="1">返回上一步</button>
          <button class="btn primary" id="genReport"><svg class="icon"><use href="#i-cup"/></svg>生成分析报告</button>
        </div>
      </section>

      <section class="panel step hidden" id="step-3" aria-labelledby="title-step3">
        <header class="panel-head">
          <h1 id="title-step3" class="display with-icon"><svg class="icon xl"><use href="#i-cup"/></svg>模拟分析报告</h1>
          <p class="lead">基于画像与产品信息的综合洞察，辅助市场判断与定价策略。</p>
        </header>
        <article class="paper">
          <div class="report-header-actions">
              <h3 class="section with-icon" style="margin: 0;"><svg class="icon"><use href="#i-users"/></svg>各画像独立报告</h3>
              <button type="button" class="btn small" id="downloadAllIndividualReports">
                  <svg class="icon"><use href="#i-download"/></svg> 下载全部HTML
              </button>
          </div>

          <div id="individual-reports-container">
              <div class="placeholder-content"><div class="spinner"></div><p>正在逐一生成独立分析报告...</p></div>
          </div>
        </article>
        <div id="next-to-summary-container" class="actions" style="display: none;">
            <button class="btn primary next" data-next="4">查看整体市场分析 <span class="arrow">→</span></button>
        </div>
      </section>

      <section class="panel step hidden" id="step-4" aria-labelledby="title-step4">
        <header class="panel-head">
            <h1 id="title-step4" class="display with-icon"><svg class="icon xl"><use href="#i-cup"/></svg>模拟分析报告</h1>
            <p class="lead">基于画像与产品信息的综合洞察，辅助市场判断与定价策略。</p>
        </header>
        <div class="stack-col summary-stack">
          <article class="paper">
            <div class="report-header-actions">
                <h3 class="section with-icon" style="margin: 0;"><svg class="icon"><use href="#i-wheat"/></svg>整体市场分析</h3>
                <button type="button" class="btn small" id="downloadSummaryReport">
                    <svg class="icon"><use href="#i-download"/></svg> 下载HTML报告
                </button>
            </div>
            <div id="summary-report-container" class="prose">
              <div class="placeholder-content"><div class="spinner"></div><p>正在汇总总体报告...</p></div>
            </div>
          </article>
          <div class="insight">
            <h3 class="section with-icon"><svg class="icon"><use href="#i-cup"/></svg>数据洞察可视化</h3>
            <div id="charts-container">
              </div>
            <div class="cta">
              <button class="btn ghost prev" data-prev="3">返回独立报告</button>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="footer">
      <span>© 2025 匠心酿造 · 品牌洞察系统</span>
    </footer>
  </div>

  <script src="{{ url_for('static', filename='script.js') }}"></script>

  <div class="modal-backdrop hidden" id="editPersonaModalBackdrop"></div>
  <div class="modal-panel panel hidden" id="editPersonaModal">
    <header class="panel-head">
        <h2 class="display" id="editPersonaTitle">编辑画像</h2>
    </header>
    <form id="editPersonaForm" onsubmit="return false;">
        
        <div class="form-grid two-col">
            <label class="field">
                <span>年龄</span>
                <input id="edit_age" type="number" min="18" max="80" required>
            </label>
            <label class="field">
                <span>性别</span>
                <select id="edit_gender">
                    </select>
            </label>
        </div>

        <div class="form-grid two-col" style="margin-top: 12px;">
            <label class="field">
                <span>城市</span>
                <select id="edit_city" required>
                    </select>
            </label>
            <label class="field">
                <span>职业</span>
                <input id="edit_profession" type="text" required>
            </label>
        </div>

        <div class="group" style="margin-top: 18px;">
            <div class="form-grid three-col">
                <label class="field">
                    <span>教育程度</span>
                    <select id="edit_education">
                       </select>
                </label>
                <label class="field">
                    <span>年收入</span>
                    <select id="edit_income">
                        </select>
                </label>
                <label class="field">
                    <span>心理价位</span>
                    <select id="edit_expected_price">
                        </select>
                </label>
            </div>
        </div>

        <div class="group">
            <div class="form-grid three-col">
                <label class="field">
                    <span>饮酒频率</span>
                    <select id="edit_drink_frequency">
                        </select>
                </label>
                <label class="field">
                    <span>酒龄 (年)</span>
                    <input id="edit_drinking_history" type="number" min="0" max="60" required>
                </label>
                <label class="field">
                    <span>偏好香型</span>
                    <select id="edit_preferred_aroma">
                       </select>
                </label>
            </div>
        </div>

        <div class="group">
            <label class="field">
                <span>MBTI</span>
                <input id="edit_mbti" type="text" pattern="[IEie][NSns][TFtf][JPjp]" placeholder="例如: ENTJ" required>
                <p class="hint" style="margin-top: 4px; margin-bottom: 0;">必须是有效的4字母 MBTI 组合 (不区分大小写)。</p>
            </label>
        </div>

        <div class="actions" style="margin-top: 24px;">
            <button type="button" class="btn outline" id="cancelEditPersona">取消</button>
            <button type="submit" class="btn primary" id="saveEditPersona">保存更改</button>
        </div>
    </form>
  </div>
  </body>
</html>